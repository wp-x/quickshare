<!DOCTYPE html>
<html lang="zh-CN" data-page="password-page">
<head>
  <%- include('partials/header') %>
  <title><%= title %></title>
  <meta name="format-detection" content="telephone=no">
  <meta name="format-detection" content="date=no">
  <meta name="format-detection" content="address=no">
  <meta name="format-detection" content="email=no">
  <!-- 禁用密码管理器 -->
  <meta name="robots" content="noai, noimageai">
  <meta name="apple-itunes-app" content="app-id=0,app-argument=none">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    /* 防止密码管理器识别 */
    .non-password {
      -webkit-text-security: none !important;
      -moz-text-security: none !important;
    }
    
    /* 防止iOS密码自动填充 */
    input[type="text"] {
      -webkit-user-select: text !important;
      user-select: text !important;
      -webkit-appearance: none;
      appearance: none;
    }
    
    /* Glass morphism effect */
    .glass-morphism {
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Floating animation */
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-900 antialiased">
  <div class="bg-custom-gray-100">
    <div class="h-screen relative z-10">
      <!-- Background video -->
      <video autoplay muted loop playsinline class="absolute inset-0 w-full h-full object-cover z-0">
        <source src="https://cdn.animatex.io/static/hero-videos/hero-bg-lossless.webm" type="video/webm"/>
        <source src="https://cdn.animatex.io/static/hero-videos/hero-bg.mp4" type="video/mp4"/>
      </video>
      <div class="absolute inset-0 bg-black/40 z-10"></div>
      
      <!-- Navigation -->
      <nav class="relative z-20 flex items-center justify-between p-6 lg:px-8">
        <div class="flex items-center">
          <a class="flex items-center space-x-2" href="/">
            <i class="fas fa-code text-white text-2xl"></i>
            <span class="text-2xl font-bold text-white">QuickShare</span>
          </a>
        </div>
      </nav>
      
      <!-- Main content -->
      <div class="relative z-20 px-6 text-center pt-32 pb-24">
        <div class="max-w-4xl mx-auto">
          <h1 class="text-5xl md:text-7xl font-bold mb-8 leading-relaxed animate-float" style="background: linear-gradient(135deg, #ffffff 0%, #e9d5ff 40%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            HTML-SHARE
          </h1>
          <p class="text-xl md:text-2xl text-gray-300 mb-12 max-w-2xl mx-auto leading-relaxed">
            分享AI生成内容的最佳方式
          </p>
          
          <!-- Password input container -->
          <div class="max-w-2xl mx-auto mb-8">
            <div class="relative glass-morphism rounded-2xl p-8 shadow-2xl">
              <div class="mb-6">
                <h2 class="text-2xl font-semibold text-white mb-2 flex items-center justify-center">
                  <i class="fas fa-lock mr-3 text-red-400"></i>此内容已加密
                </h2>
                <p class="text-gray-300 text-lg">请输入密码</p>
              </div>
              
              <% if (error) { %>
                <div class="mb-6 bg-red-500/20 text-red-300 p-4 rounded-xl border border-red-500/30 text-sm">
                  <%= error %>
                </div>
              <% } %>
              
              <form action="/view/<%= id %>" method="get" class="password-form" id="passwordForm" onsubmit="return false;" autocomplete="off" data-lpignore="true" data-1p-ignore>
                <div class="password-input-container">
                  <!-- 欺骗密码管理器的字段 -->
                  <input type="password" name="password" style="display:none" aria-hidden="true">
                  <input type="text" 
                         name="pin_code" 
                         maxlength="5" 
                         class="w-full bg-transparent border-0 text-white placeholder:text-gray-400 focus-visible:ring-0 focus-visible:ring-offset-0 text-2xl h-16 text-center non-password rounded-xl glass-morphism font-mono tracking-widest" 
                         placeholder="*****" 
                         autocomplete="off" 
                         autofocus 
                         inputmode="numeric" 
                         pattern="[0-9]*" 
                         onkeypress="return event.charCode >= 48 && event.charCode <= 57" 
                         oninput="handlePasswordInput(this.value)" 
                         readonly 
                         onfocus="this.removeAttribute('readonly');" 
                         data-lpignore="true" 
                         data-form-type="other" 
                         data-1p-ignore 
                         spellcheck="false" 
                         autocorrect="off" 
                         autocapitalize="off">
                  
                  <div class="digit-indicators flex justify-center gap-3 mt-6">
                    <span class="digit-indicator w-4 h-4 rounded-full bg-gray-600 transition-all duration-300"></span>
                    <span class="digit-indicator w-4 h-4 rounded-full bg-gray-600 transition-all duration-300"></span>
                    <span class="digit-indicator w-4 h-4 rounded-full bg-gray-600 transition-all duration-300"></span>
                    <span class="digit-indicator w-4 h-4 rounded-full bg-gray-600 transition-all duration-300"></span>
                    <span class="digit-indicator w-4 h-4 rounded-full bg-gray-600 transition-all duration-300"></span>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%- include('partials/footer') %>

  <script src="/js/particles.js"></script>
  <script src="/js/theme.js"></script>
  <script>
    // 禁用iOS密码自动填充
    document.addEventListener('DOMContentLoaded', function() {
      // 延迟执行，确保页面完全加载
      setTimeout(function() {
        // 获取输入框元素
        const input = document.querySelector('.password-input');
        // 如果输入框存在，执行防止密码管理器的操作
        if (input) {
          // 先移除焦点
          input.blur();
          // 修改输入框类型，再改回来，扰乱密码管理器
          input.type = 'email';
          setTimeout(function() {
            input.type = 'text';
            // 重新聚焦
            input.focus();
          }, 100);
        }
      }, 300);
    });
    
    // Store the current page ID for validation
    const pageId = '<%= id %>';
    
    function handlePasswordInput(value) {
      const indicators = document.querySelectorAll('.digit-indicator');
      const passwordInput = document.querySelector('input[name="pin_code"]');
      const form = document.getElementById('passwordForm');
      
      // Reset all indicators and remove status classes
      indicators.forEach(indicator => {
        indicator.classList.remove('filled', 'correct', 'incorrect');
        indicator.classList.add('bg-gray-600');
        indicator.classList.remove('bg-white', 'bg-green-400', 'bg-red-400');
      });
      
      // Fill indicators based on password length (white color)
      for (let i = 0; i < value.length; i++) {
        if (i < indicators.length) {
          indicators[i].classList.add('filled');
          indicators[i].classList.remove('bg-gray-600');
          indicators[i].classList.add('bg-white');
        }
      }
      
      // If all 5 digits are entered, validate the password
      if (value.length === 5) {
        validatePassword(value);
      }
    }
    
    function validatePassword(password) {
      // Send AJAX request to validate password
      fetch(`/validate-password/${pageId}?password=${password}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        const indicators = document.querySelectorAll('.digit-indicator');
        const passwordInput = document.querySelector('input[name="pin_code"]');
        
        if (data.valid) {
          // Password is correct - show green indicators
          indicators.forEach(indicator => {
            indicator.classList.add('correct');
            indicator.classList.remove('bg-white', 'bg-gray-600');
            indicator.classList.add('bg-green-400');
          });
          
          // Redirect to the content page after a short delay
          setTimeout(() => {
            window.location.href = `/view/${pageId}?password=${password}`;
          }, 500);
        } else {
          // Password is incorrect - show red indicators
          indicators.forEach(indicator => {
            indicator.classList.add('incorrect');
            indicator.classList.remove('bg-white', 'bg-gray-600');
            indicator.classList.add('bg-red-400');
          });
          
          // Clear the input after a short delay
          setTimeout(() => {
            passwordInput.value = '';
            indicators.forEach(indicator => {
              indicator.classList.remove('filled', 'correct', 'incorrect', 'bg-white', 'bg-green-400', 'bg-red-400');
              indicator.classList.add('bg-gray-600');
            });
          }, 1000);
        }
      })
      .catch(error => {
        console.error('Error validating password:', error);
      });
    }
  </script>
</body>
</html>
