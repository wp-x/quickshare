 # HTML-Go Express æ•°æ®å­˜å‚¨å’Œç®¡ç†è¯´æ˜

## ğŸ“Š æ•°æ®å­˜å‚¨ä½ç½®

### Docker éƒ¨ç½²ç¯å¢ƒ

å½“ä½¿ç”¨ Docker éƒ¨ç½²æ—¶ï¼Œæ•°æ®å­˜å‚¨åœ¨ä»¥ä¸‹ä½ç½®ï¼š

#### å®¹å™¨å†…è·¯å¾„
- **æ•°æ®åº“æ–‡ä»¶**: `/usr/src/app/db/html-go.db`
- **ä¼šè¯æ–‡ä»¶**: `/usr/src/app/sessions/`
- **åº”ç”¨æ•°æ®**: `/usr/src/app/data/`

#### Docker å·æ˜ å°„
åœ¨ `docker-compose.yml` ä¸­é…ç½®çš„æ•°æ®å·ï¼š
```yaml
volumes:
  - html-go-data:/usr/src/app/data      # åº”ç”¨æ•°æ®
  - html-go-sessions:/usr/src/app/sessions  # ä¼šè¯æ•°æ®
  - html-go-db:/usr/src/app/db          # æ•°æ®åº“æ–‡ä»¶
```

#### å®¿ä¸»æœºè®¿é—®
```bash
# æŸ¥çœ‹æ•°æ®å·ä½ç½®
docker volume inspect quickshare_html-go-db

# è¿›å…¥å®¹å™¨æŸ¥çœ‹æ•°æ®
docker exec -it html-go-express sh
ls -la /usr/src/app/db/
```

### ç›´æ¥éƒ¨ç½²ç¯å¢ƒ

å½“ç›´æ¥åœ¨ç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œæ•°æ®å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼š
- **æ•°æ®åº“æ–‡ä»¶**: `./db/html-go.db`
- **ä¼šè¯æ–‡ä»¶**: `./sessions/`
- **åº”ç”¨æ•°æ®**: `./data/`

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### pages è¡¨
å­˜å‚¨æ‰€æœ‰åˆ†äº«çš„HTML/Markdown/SVG/Mermaidå†…å®¹ï¼š

```sql
CREATE TABLE pages (
  id TEXT PRIMARY KEY,              -- é¡µé¢å”¯ä¸€ID (7ä½å“ˆå¸Œ)
  html_content TEXT NOT NULL,       -- é¡µé¢å†…å®¹
  created_at INTEGER NOT NULL,      -- åˆ›å»ºæ—¶é—´æˆ³
  password TEXT,                    -- è®¿é—®å¯†ç  (5ä½æ•°å­—)
  is_protected INTEGER DEFAULT 0,   -- æ˜¯å¦å—ä¿æŠ¤ (0=å…¬å¼€, 1=å—ä¿æŠ¤)
  code_type TEXT DEFAULT 'html'     -- å†…å®¹ç±»å‹ (html/markdown/svg/mermaid)
);
```

### å­—æ®µè¯´æ˜
- **id**: ç”±å†…å®¹å’Œæ—¶é—´æˆ³ç”Ÿæˆçš„MD5å“ˆå¸Œçš„å‰7ä½
- **html_content**: ç”¨æˆ·æäº¤çš„åŸå§‹å†…å®¹
- **created_at**: Unixæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- **password**: 5ä½çº¯æ•°å­—å¯†ç ï¼Œæ‰€æœ‰é¡µé¢éƒ½ä¼šç”Ÿæˆ
- **is_protected**: å†³å®šæ˜¯å¦éœ€è¦å¯†ç æ‰èƒ½è®¿é—®
- **code_type**: è‡ªåŠ¨æ£€æµ‹çš„å†…å®¹ç±»å‹

## ğŸ” ç®¡ç†ç•Œé¢åŠŸèƒ½

### è®¿é—®ç®¡ç†ç•Œé¢
- **URL**: `http://localhost:8888/admin`
- **è®¤è¯**: éœ€è¦ç™»å½•è®¤è¯
- **åŠŸèƒ½**: æŸ¥çœ‹ã€æœç´¢ã€ç®¡ç†æ‰€æœ‰åˆ†äº«çš„å†…å®¹

### ä¸»è¦åŠŸèƒ½

#### 1. ç»Ÿè®¡ä¿¡æ¯
- æ€»é¡µé¢æ•°
- å—ä¿æŠ¤é¡µé¢æ•°
- ä»Šæ—¥æ–°å¢é¡µé¢æ•°

#### 2. æœç´¢å’Œè¿‡æ»¤
- **æœç´¢**: æŒ‰é¡µé¢IDæˆ–å†…å®¹æœç´¢
- **ç±»å‹è¿‡æ»¤**: HTMLã€Markdownã€SVGã€Mermaid
- **çŠ¶æ€è¿‡æ»¤**: å…¬å¼€ã€å—ä¿æŠ¤

#### 3. é¡µé¢ç®¡ç†
- **æŸ¥çœ‹è¯¦æƒ…**: ç‚¹å‡»é¡µé¢é¡¹æŸ¥çœ‹å®Œæ•´ä¿¡æ¯
- **å¤åˆ¶é“¾æ¥**: å¿«é€Ÿå¤åˆ¶åˆ†äº«é“¾æ¥
- **å¤åˆ¶å¯†ç **: å¤åˆ¶è®¿é—®å¯†ç ï¼ˆå¦‚æœæœ‰ï¼‰
- **åˆ é™¤é¡µé¢**: åˆ é™¤ä¸éœ€è¦çš„é¡µé¢

#### 4. è§†å›¾æ¨¡å¼
- **ç½‘æ ¼è§†å›¾**: å¡ç‰‡å¼å±•ç¤ºï¼ŒåŒ…å«å†…å®¹é¢„è§ˆ
- **åˆ—è¡¨è§†å›¾**: ç´§å‡‘çš„åˆ—è¡¨å±•ç¤º

## ğŸ“‹ API æ¥å£

### ç®¡ç† API

#### è·å–æ‰€æœ‰é¡µé¢
```http
GET /api/admin/pages
Authorization: éœ€è¦ç™»å½•è®¤è¯

Response:
{
  "success": true,
  "pages": [...],
  "stats": {
    "total": 100,
    "protected": 25,
    "today": 5
  }
}
```

#### åˆ é™¤é¡µé¢
```http
DELETE /api/admin/pages/:id
Authorization: éœ€è¦ç™»å½•è®¤è¯

Response:
{
  "success": true,
  "message": "é¡µé¢åˆ é™¤æˆåŠŸ"
}
```

#### è·å–ç»Ÿè®¡ä¿¡æ¯
```http
GET /api/admin/stats
Authorization: éœ€è¦ç™»å½•è®¤è¯

Response:
{
  "success": true,
  "stats": {
    "total": 100,
    "protected": 25,
    "byType": [...],
    "byDate": [...],
    "bySize": [...]
  }
}
```

## ğŸ’¾ æ•°æ®å¤‡ä»½å’Œæ¢å¤

### Docker ç¯å¢ƒå¤‡ä»½

#### 1. å¤‡ä»½æ•°æ®å·
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p ./backups

# å¤‡ä»½æ•°æ®åº“
docker run --rm \
  -v quickshare_html-go-db:/data \
  -v $(pwd)/backups:/backup \
  alpine tar -czvf /backup/db-backup-$(date +%Y%m%d-%H%M%S).tar.gz /data

# å¤‡ä»½ä¼šè¯æ•°æ®
docker run --rm \
  -v quickshare_html-go-sessions:/data \
  -v $(pwd)/backups:/backup \
  alpine tar -czvf /backup/sessions-backup-$(date +%Y%m%d-%H%M%S).tar.gz /data
```

#### 2. æ¢å¤æ•°æ®
```bash
# åœæ­¢æœåŠ¡
docker-compose down

# æ¢å¤æ•°æ®åº“
docker run --rm \
  -v quickshare_html-go-db:/data \
  -v $(pwd)/backups:/backup \
  alpine sh -c "rm -rf /data/* && tar -xzvf /backup/db-backup-YYYYMMDD-HHMMSS.tar.gz -C /"

# é‡å¯æœåŠ¡
docker-compose up -d
```

### ç›´æ¥éƒ¨ç½²ç¯å¢ƒå¤‡ä»½

#### 1. å¤‡ä»½æ•°æ®
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p ./backups

# å¤‡ä»½æ•°æ®åº“
cp ./db/html-go.db ./backups/html-go-backup-$(date +%Y%m%d-%H%M%S).db

# å¤‡ä»½ä¼šè¯æ–‡ä»¶
tar -czvf ./backups/sessions-backup-$(date +%Y%m%d-%H%M%S).tar.gz ./sessions/
```

#### 2. æ¢å¤æ•°æ®
```bash
# åœæ­¢åº”ç”¨
# æ¢å¤æ•°æ®åº“
cp ./backups/html-go-backup-YYYYMMDD-HHMMSS.db ./db/html-go.db

# æ¢å¤ä¼šè¯æ–‡ä»¶
tar -xzvf ./backups/sessions-backup-YYYYMMDD-HHMMSS.tar.gz
```

## ğŸ”§ æ•°æ®åº“ç»´æŠ¤

### ç›´æ¥è®¿é—®æ•°æ®åº“

#### Docker ç¯å¢ƒ
```bash
# è¿›å…¥å®¹å™¨
docker exec -it html-go-express sh

# ä½¿ç”¨ sqlite3 å‘½ä»¤è¡Œ
sqlite3 /usr/src/app/db/html-go.db

# å¸¸ç”¨æŸ¥è¯¢
.tables                           # æŸ¥çœ‹æ‰€æœ‰è¡¨
.schema pages                     # æŸ¥çœ‹è¡¨ç»“æ„
SELECT COUNT(*) FROM pages;       # ç»Ÿè®¡æ€»æ•°
SELECT * FROM pages LIMIT 5;      # æŸ¥çœ‹å‰5æ¡è®°å½•
```

#### ç›´æ¥éƒ¨ç½²ç¯å¢ƒ
```bash
# å®‰è£… sqlite3ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
sudo apt-get install sqlite3  # Ubuntu/Debian
brew install sqlite3           # macOS

# è®¿é—®æ•°æ®åº“
sqlite3 ./db/html-go.db

# æ‰§è¡ŒæŸ¥è¯¢
SELECT id, created_at, is_protected, code_type FROM pages ORDER BY created_at DESC LIMIT 10;
```

### å¸¸ç”¨ç»´æŠ¤æŸ¥è¯¢

#### 1. æ¸…ç†è¿‡æœŸæ•°æ®
```sql
-- åˆ é™¤30å¤©å‰çš„æ•°æ®
DELETE FROM pages WHERE created_at < (strftime('%s', 'now', '-30 days') * 1000);

-- åˆ é™¤æœªå—ä¿æŠ¤çš„æ—§æ•°æ®
DELETE FROM pages 
WHERE is_protected = 0 
  AND created_at < (strftime('%s', 'now', '-7 days') * 1000);
```

#### 2. ç»Ÿè®¡æŸ¥è¯¢
```sql
-- æŒ‰ç±»å‹ç»Ÿè®¡
SELECT code_type, COUNT(*) as count FROM pages GROUP BY code_type;

-- æŒ‰ä¿æŠ¤çŠ¶æ€ç»Ÿè®¡
SELECT 
  CASE WHEN is_protected = 1 THEN 'å—ä¿æŠ¤' ELSE 'å…¬å¼€' END as status,
  COUNT(*) as count 
FROM pages 
GROUP BY is_protected;

-- æŒ‰æ—¥æœŸç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰
SELECT 
  DATE(created_at/1000, 'unixepoch') as date,
  COUNT(*) as count
FROM pages 
WHERE created_at >= (strftime('%s', 'now', '-7 days') * 1000)
GROUP BY DATE(created_at/1000, 'unixepoch')
ORDER BY date DESC;
```

#### 3. å†…å®¹åˆ†æ
```sql
-- æŸ¥æ‰¾å¤§æ–‡ä»¶
SELECT id, LENGTH(html_content) as size 
FROM pages 
ORDER BY size DESC 
LIMIT 10;

-- æŸ¥æ‰¾æœ€è¿‘åˆ›å»ºçš„é¡µé¢
SELECT id, datetime(created_at/1000, 'unixepoch') as created, code_type
FROM pages 
ORDER BY created_at DESC 
LIMIT 10;
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“å®‰å…¨
- å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- é™åˆ¶æ•°æ®åº“æ–‡ä»¶çš„è®¿é—®æƒé™
- è€ƒè™‘åŠ å¯†æ•æ„Ÿæ•°æ®

### 2. å¯†ç ç®¡ç†
- é¡µé¢å¯†ç ä»¥æ˜æ–‡å­˜å‚¨ï¼ˆ5ä½æ•°å­—ï¼‰
- è€ƒè™‘å®æ–½å¯†ç å“ˆå¸Œï¼ˆå¦‚éœ€æ›´é«˜å®‰å…¨æ€§ï¼‰
- å®šæœŸæ¸…ç†è¿‡æœŸçš„å—ä¿æŠ¤é¡µé¢

### 3. è®¿é—®æ§åˆ¶
- ç®¡ç†ç•Œé¢éœ€è¦è®¤è¯
- APIæ¥å£æœ‰é€‚å½“çš„æƒé™æ§åˆ¶
- è€ƒè™‘å®æ–½IPç™½åå•ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_created_at ON pages(created_at);
CREATE INDEX idx_is_protected ON pages(is_protected);
CREATE INDEX idx_code_type ON pages(code_type);
```

### 2. å®šæœŸæ¸…ç†
- è®¾ç½®è‡ªåŠ¨æ¸…ç†ç­–ç•¥
- åˆ é™¤è¿‡æœŸçš„ä¼šè¯æ–‡ä»¶
- å‹ç¼©æ•°æ®åº“æ–‡ä»¶

### 3. ç›‘æ§
- ç›‘æ§æ•°æ®åº“å¤§å°
- è·Ÿè¸ªé¡µé¢åˆ›å»ºé¢‘ç‡
- ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨

---

é€šè¿‡ä»¥ä¸Šè¯´æ˜ï¼Œæ‚¨å¯ä»¥å…¨é¢äº†è§£å’Œç®¡ç† HTML-Go Express çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚